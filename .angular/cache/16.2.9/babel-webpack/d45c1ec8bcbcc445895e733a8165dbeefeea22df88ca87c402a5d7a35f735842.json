{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport class ConnectionService {\n  constructor() {\n    this.myPlayerId = -1;\n    this.myConnectionId = -1;\n    this.messageBehaviourSubject = new BehaviorSubject({\n      messageType: \"init\"\n    });\n    this.ws = new WebSocket(\"ws://localhost:8080\");\n    this.ws.onopen = function () {\n      // Web Socket is connected, send data using send()\n      console.log(\"Connection successful\");\n    };\n    this.ws.onmessage = evt => {\n      let received_msg = JSON.parse(evt.data);\n      console.log(\"Message received... \" + JSON.stringify(received_msg));\n      switch (received_msg.messageType) {\n        case \"connection\":\n          {\n            this.myConnectionId = received_msg.connectionId;\n            break;\n          }\n        case \"newPlayer\":\n          {\n            if (this.myConnectionId === received_msg.connectionId) {\n              this.myPlayerId = received_msg.playerId;\n            }\n            this.forward(received_msg);\n            console.log(`New player: ${received_msg.data.name}`);\n            break;\n          }\n        case \"predictionRequest\":\n          {\n            this.forward(received_msg);\n            break;\n          }\n        case \"hand\":\n          {\n            this.forward(received_msg);\n            break;\n          }\n        case \"predictions\":\n          {\n            this.forward(received_msg);\n            break;\n          }\n        case \"playCard\":\n          {\n            this.forward(received_msg);\n            break;\n          }\n        case \"scoreboard\":\n          {\n            this.forward(received_msg);\n            break;\n          }\n        default:\n          {\n            console.log(\"unrecognised message type received\");\n          }\n      }\n    };\n    this.ws.onclose = () => {\n      // websocket is closed.\n      this.myConnectionId = -1;\n      alert(\"Connection is closed...\");\n    };\n  }\n  getMessageBehaviourSubject() {\n    return this.messageBehaviourSubject;\n  }\n  send(messageType, data) {\n    let dataSection = data ? `,\"data\":${JSON.stringify(data)}` : \"\";\n    this.ws.send(`{\"connectionId\": ${this.myConnectionId},\"playerId\": ${this.myPlayerId},\"messageType\":\"${messageType}\"${dataSection}}`);\n  }\n  forward(msg) {\n    this.messageBehaviourSubject.next({\n      messageType: msg.messageType,\n      data: msg.data ? msg.data : undefined\n    });\n  }\n  isConnected() {\n    return this.myConnectionId !== -1;\n  }\n  static #_ = this.ɵfac = function ConnectionService_Factory(t) {\n    return new (t || ConnectionService)();\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ConnectionService,\n    factory: ConnectionService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["BehaviorSubject","ConnectionService","constructor","myPlayerId","myConnectionId","messageBehaviourSubject","messageType","ws","WebSocket","onopen","console","log","onmessage","evt","received_msg","JSON","parse","data","stringify","connectionId","playerId","forward","name","onclose","alert","getMessageBehaviourSubject","send","dataSection","msg","next","undefined","isConnected","_","_2","factory","ɵfac","providedIn"],"sources":["/Users/john/Projects/Clag/ClagClient2/src/app/connection.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nexport interface Message {\n  messageType: string,\n  data?: any\n}\n\ninterface ServerMessage {\n  playerId: number,\n  connectionId: number,\n  messageType: string,\n  data?: any\n}\n\n@Injectable({ providedIn: 'root' })\nexport class ConnectionService {\n\n  myPlayerId: number = -1\n  myConnectionId: number = -1\n\n  messageBehaviourSubject: BehaviorSubject<Message> = new BehaviorSubject({\n    messageType: \"init\"\n  })\n\n  ws: WebSocket\n\n  constructor() {\n\n    this.ws = new WebSocket(\"ws://localhost:8080\");\n\t\t\t\t\n      this.ws.onopen = function() {\n        \n        // Web Socket is connected, send data using send()\n        console.log(\"Connection successful\")\n      };\n\n      this.ws.onmessage = (evt) => { \n        let received_msg = JSON.parse(evt.data) as ServerMessage;\n        console.log(\"Message received... \" + JSON.stringify(received_msg));\n\n        switch(received_msg.messageType) {\n          case \"connection\": {\n            this.myConnectionId = received_msg.connectionId\n            break\n          }\n          case \"newPlayer\": {\n            if ( this.myConnectionId === received_msg.connectionId) {\n              this.myPlayerId = received_msg.playerId\n            }\n            this.forward(received_msg)\n            console.log(`New player: ${received_msg.data.name}`)\n            break\n          }\n          case \"predictionRequest\": {\n            this.forward(received_msg)\n            break\n          }\n          case \"hand\": {\n            this.forward(received_msg)\n            break\n          }\n          case \"predictions\": {\n            this.forward(received_msg)\n            break\n          }\n          case \"playCard\": {\n            this.forward(received_msg)\n            break\n          }\n          case \"scoreboard\": {\n            this.forward(received_msg)\n            break\n          }\n          default: {\n            console.log(\"unrecognised message type received\")\n          }\n        }\n        \n      };\n\n      this.ws.onclose = () => { \n        \n        // websocket is closed.\n        this.myConnectionId = -1\n        alert(\"Connection is closed...\"); \n      };\n  }\n\n  getMessageBehaviourSubject(): BehaviorSubject<Message> {\n    return this.messageBehaviourSubject\n  }\n\n  send(messageType: string, data?: any) {\n    let dataSection: string = data ? `,\"data\":${JSON.stringify(data)}` : \"\"\n    this.ws.send(`{\"connectionId\": ${this.myConnectionId},\"playerId\": ${this.myPlayerId},\"messageType\":\"${messageType}\"${dataSection}}`);\n  }\n\n  forward(msg: ServerMessage) {\n    this.messageBehaviourSubject.next({\n      messageType: msg.messageType,\n      data: msg.data ? msg.data : undefined\n    })\n  }\n\n  isConnected(): boolean {\n    return this.myConnectionId !== -1\n  }\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}